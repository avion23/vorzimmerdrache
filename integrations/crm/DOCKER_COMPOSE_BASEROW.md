# Baserow Docker Compose Configuration

## Add to `docker-compose.yml`

Add the following service to your `docker-compose.yml` file after the `telegram-bot` service:

```yaml
  baserow:
    image: baserow/baserow:1.24.0
    container_name: baserow
    restart: unless-stopped
    environment:
      BASEROW_PUBLIC_URL: ${BASEROW_PUBLIC_URL:-http://localhost:8000}
      DATABASE_HOST: postgres
      DATABASE_NAME: ${POSTGRES_DB:-n8n}
      DATABASE_USER: ${POSTGRES_USER:-n8n}
      DATABASE_PASSWORD: ${POSTGRES_PASSWORD}
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: ${REDIS_PASSWORD}
      BASEROW_JWT_SIGNING_KEY: ${BASEROW_JWT_SIGNING_KEY}
      BASEROW_WEBHOOKS_ALLOW_PRIVATE_ADDRESS: 'true'
    volumes:
      - baserow_data:/baserow/data
    networks:
      - backend
      - frontend
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.baserow.rule=Host(`${BASEROW_HOST:-baserow.${DOMAIN}}`)"
      - "traefik.http.routers.baserow.entrypoints=websecure"
      - "traefik.http.routers.baserow.tls=true"
      - "traefik.http.routers.baserow.tls.certresolver=letsencrypt"
```

## Add Volume

Add `baserow_data` to the volumes section:

```yaml
volumes:
  postgres_data:
  redis_data:
  n8n_data:
  waha_data:
  waha_sessions:
  traefik_letsencrypt:
  uptime_kuma_data:
  telegram_bot_data:
  baserow_data:
```

## Environment Variables

Add these to your `.env` file:

```bash
BASEROW_HOST=baserow.yourdomain.com
BASEROW_PUBLIC_URL=https://baserow.yourdomain.com
BASEROW_JWT_SIGNING_KEY=<generate with: openssl rand -hex 32>
BASEROW_TABLE_ID=  # Auto-discovered by sync script
BASEROW_API_TOKEN=  # Auto-generated by setup script
```

## Network Configuration

Baserow uses two networks:
- `backend`: Internal communication with PostgreSQL and Redis
- `frontend`: External access via Traefik

## Services

- **PostgreSQL**: Stores Baserow data (shared with n8n)
- **Redis**: Caching and session management (shared with n8n)
- **Traefik**: SSL termination and reverse proxy

## Ports

Baserow exposes port 8000 internally but is accessed via Traefik on port 443 (HTTPS).

## Startup Order

Baserow automatically waits for PostgreSQL and Redis to be healthy before starting.

## Data Persistence

All Baserow data is persisted in the `baserow_data` volume including:
- Database schema and data
- User sessions
- File uploads
- View configurations
- Webhook configurations

## Health Checks

Baserow provides a health endpoint at `/api/health/` which is checked automatically.

## Troubleshooting

### Check logs:
```bash
docker-compose logs -f baserow
```

### Restart Baserow:
```bash
docker-compose restart baserow
```

### Access Baserow container:
```bash
docker exec -it baserow bash
```

### Verify database connection:
```bash
docker exec -it baserow python3 /baserow/backend/src/baserow/manage.py shell
```

### View environment variables:
```bash
docker exec baserow env | grep BASEROW
```
